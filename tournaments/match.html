<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Create Match Play Tournament</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
      body{padding-top:70px}
      .form-card{max-width:700px;margin:60px auto;padding:36px;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.06)}
      .field{margin-bottom:20px}
      label{display:block;font-weight:600;margin-bottom:8px;font-size:15px}
      input[type="text"], select{width:100%;padding:12px 14px;border-radius:8px;border:1px solid #e6e9ef;font-size:15px;box-sizing:border-box}
      .help-text{font-size:13px;color:#64748b;margin-top:4px}
      .actions{display:flex;gap:12px;margin-top:24px}
      .btn-primary{background:linear-gradient(180deg,var(--accent),#0a58d1);color:white;border:0;padding:12px 16px;border-radius:8px;cursor:pointer;font-weight:600;flex:1}
      .btn-secondary{background:white;border:1px solid #e6e9ef;padding:12px 16px;border-radius:8px;cursor:pointer;font-weight:600;flex:1;text-decoration:none;text-align:center}
    </style>
  </head>
  <body>
    <div class="top-nav">
      <h1>üèÜ Match Play Tournament</h1>
      <a href="index.html" class="btn-back-top">‚Üê Back</a>
    </div>
    <main class="form-card">
      <p style="color:#64748b;margin-bottom:28px">Configure your match play event details.</p>
      
      <form id="match-form">
        <div class="field">
          <label for="tournament-name">Tournament Name</label>
          <input id="tournament-name" name="name" type="text" required placeholder="e.g. Club Championship Match Play">
        </div>

        <div class="field">
          <label for="game-format">Game Format</label>
          <select id="game-format" name="gameFormat" required>
            <option value="">-- Select format --</option>
            <option value="singles">Singles</option>
            <option value="fourball">Fourball</option>
            <option value="foursome">Foursome</option>
          </select>
          <p class="help-text">Singles: 1v1 | Fourball: Best ball of 2v2 | Foursome: Alternate shot 2v2</p>
        </div>

        <div class="field">
          <label for="match-type">Match Play Type</label>
          <select id="match-type" name="matchType" required>
            <option value="">-- Select type --</option>
            <option value="tournament">Match Play Tournament</option>
            <option value="series">Match Play Series</option>
          </select>
          <p class="help-text">Tournament: Single event | Series: Bracket format (64‚Üí32‚Üí16‚Üí8‚Üí4‚Üí2‚ÜíWinner)</p>
        </div>

        <div class="field">
          <label for="hcp-allowance">HCP Allowance</label>
          <select id="hcp-allowance" name="hcpAllowance" required>
            <option value="100">100%</option>
            <option value="95">95%</option>
            <option value="90">90%</option>
            <option value="85">85%</option>
            <option value="80">80%</option>
            <option value="75">75%</option>
            <option value="50">50%</option>
            <option value="0">0% (Scratch)</option>
          </select>
          <p class="help-text">Percentage of handicap difference applied to matches</p>
        </div>

        <div class="actions">
          <button type="submit" class="btn-primary">Continue</button>
        </div>
      </form>
    </main>

    <script>
      const params = new URLSearchParams(window.location.search);
      const editIndexParam = params.get('edit');
      const isEdit = editIndexParam !== null;

      // If editing, load tournament data
      if (isEdit) {
        const editIndex = parseInt(editIndexParam, 10);
        const tournaments = getTournaments();
        const tournament = tournaments[editIndex];
        
        if (tournament && tournament.type === 'match') {
          document.getElementById('tournament-name').value = tournament.name || '';
          document.getElementById('game-format').value = tournament.gameFormat || '';
          document.getElementById('match-type').value = tournament.matchType || '';
          document.getElementById('hcp-allowance').value = tournament.hcpAllowance || '100';
        }
      }

      function getTournaments() {
        try {
          const raw = localStorage.getItem('tournaments');
          return raw ? JSON.parse(raw) : [];
        } catch(e) {
          console.error('Error loading tournaments:', e);
          return [];
        }
      }

      function saveTournaments(list) {
        try {
          localStorage.setItem('tournaments', JSON.stringify(list));
        } catch(e) {
          console.error('Error saving tournaments:', e);
          alert('Error saving tournament: ' + e.message);
        }
      }

      function generateTournamentId() {
        const tournaments = getTournaments();
        let maxNum = 0;
        tournaments.forEach(function(t) {
          const match = (t.tournamentId || '').match(/^T(\d+)$/);
          if (match) {
            maxNum = Math.max(maxNum, parseInt(match[1], 10));
          }
        });
        return 'T' + String(maxNum + 1).padStart(3, '0');
      }

      document.getElementById('match-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const name = document.getElementById('tournament-name').value.trim();
        const gameFormat = document.getElementById('game-format').value;
        const matchType = document.getElementById('match-type').value;
        const hcpAllowance = document.getElementById('hcp-allowance').value;

        if (!name || !gameFormat || !matchType || !hcpAllowance) {
          alert('Please fill in all required fields.');
          return;
        }

        const tournament = {
          tournamentId: isEdit ? getTournaments()[parseInt(editIndexParam, 10)].tournamentId : generateTournamentId(),
          name: name,
          type: 'match',
          gameFormat: gameFormat,
          matchType: matchType,
          hcpAllowance: hcpAllowance,
          createdAt: isEdit ? getTournaments()[parseInt(editIndexParam, 10)].createdAt : new Date().toISOString(),
          updatedAt: new Date().toISOString(),
          meta: isEdit ? getTournaments()[parseInt(editIndexParam, 10)].meta : {}
        };

        const tournaments = getTournaments();
        
        if (isEdit) {
          tournaments[parseInt(editIndexParam, 10)] = tournament;
        } else {
          tournaments.push(tournament);
        }

        saveTournaments(tournaments);

        alert(isEdit ? 'Match Play tournament updated successfully!' : 'Match Play tournament created successfully!');
        window.location.href = 'index.html';
      });
    </script>
  </body>
</html>
