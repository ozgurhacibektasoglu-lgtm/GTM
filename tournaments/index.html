<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tournaments</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="../firebase-config.js"></script>
    
    <link rel="stylesheet" href="../styles.css">
    <style>
      .tournaments-container { max-width: 1200px; margin: 36px auto; padding: 24px; }
      .table-wrapper { background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(2,6,23,0.06); margin-bottom: 24px; overflow-x: auto; }
      table { width: 100%; border-collapse: collapse; }
      th { background: #f3f4f6; font-weight: 600; text-align: left; padding: 12px 16px; border-bottom: 2px solid #e5e7eb; }
      th.sortable { cursor: pointer; user-select: none; }
      th .sort-indicator { margin-left: 8px; font-size: 12px; color: #475569 }
      td { padding: 12px 16px; border-bottom: 1px solid #e5e7eb; }
      tr { cursor: pointer; }
      tr.selected { background: #dbeafe; }
      tbody tr:hover { background: #f0f9ff; }
      .action-buttons { display: flex; flex-wrap: wrap; gap: 10px; }
      .btn { background: linear-gradient(180deg, var(--accent), #0a58d1); color: white; border: 0; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 14px; transition: transform 0.08s; }
      .btn:active { transform: translateY(1px); }
      .btn-back { background: white; color: #0b6efd; border: 1px solid #e6e9ef; }
      .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:1000}
      .modal-overlay.active{display:flex}
      .modal-content{background:white;border-radius:12px;padding:24px;max-width:400px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,0.3)}
      .modal-content h2{margin-top:0;font-size:20px;color:#1e293b}
      .modal-content label{display:block;font-weight:600;margin-bottom:8px;margin-top:16px}
      .modal-content select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:15px}
      .modal-buttons{display:flex;gap:10px;margin-top:20px;justify-content:flex-end}
      .modal-buttons button{padding:10px 20px;border-radius:8px;border:0;cursor:pointer;font-size:14px}
      .modal-buttons .btn-primary{background:linear-gradient(180deg,var(--accent),#0a58d1);color:white}
      .modal-buttons .btn-secondary{background:white;border:1px solid #e6e9ef;color:#333}
    </style>
  </head>
  <body>
    <!-- Round Selection Modal -->
    <div id="round-modal" class="modal-overlay">
      <div class="modal-content">
        <h2>Select Round</h2>
        <p>This is a multi-day tournament. Please select which round you want to manage admissions for:</p>
        <label for="modal-round-select">Round:</label>
        <select id="modal-round-select">
          <!-- Populated dynamically -->
        </select>
        <div class="modal-buttons">
          <button class="btn-secondary" onclick="closeRoundModal()">Cancel</button>
          <button class="btn-primary" onclick="confirmRoundSelection()">Continue</button>
        </div>
      </div>
    </div>
    <main class="tournaments-container">
      <header>
        <h1>Tournaments</h1>
        <p class="lead">Manage tournament information, admissions, draws, and results.</p>
      </header>

      <div class="table-wrapper">
        <table id="tournaments-table">
          <thead>
              <tr>
                <th data-key="tournamentId" style="width:90px">Tur. ID <span class="sort-indicator"></span></th>
                <th data-key="date">Date <span class="sort-indicator"></span></th>
                <th data-key="name">Tournament Name <span class="sort-indicator"></span></th>
                <th data-key="rounds">Rounds <span class="sort-indicator"></span></th>
                <th data-key="courses">Courses <span class="sort-indicator"></span></th>
                <th data-key="type">Tournament Type <span class="sort-indicator"></span></th>
              </tr>
          </thead>
          <tbody id="tournaments-body">
            <!-- Rows will be inserted here by JavaScript -->
          </tbody>
        </table>
      </div>

      <div class="action-buttons" style="margin-bottom: 24px;">
        <button class="btn" id="btn-new-tournament">New Tournament</button>
        <button class="btn" id="btn-modify-tournament">Modify Tournament</button>
        <button class="btn" id="btn-delete-tournament" style="background: linear-gradient(180deg, #dc2626, #991b1b);">Delete Tournament</button>
        <button class="btn" id="btn-admissions">Admissions</button>
        <button class="btn" id="btn-draw">Draw</button>
        <button class="btn" id="btn-categories">Categories</button>
        <button class="btn" id="btn-scores">Scores</button>
        <button class="btn" id="btn-results">Results</button>
        <button class="btn" id="btn-documents">Documents</button>
        <button class="btn" id="btn-export-data" style="background: linear-gradient(180deg, #059669, #047857);">üì§ Export Data</button>
        <button class="btn" id="btn-push-cloud" style="background: linear-gradient(180deg, #8b5cf6, #7c3aed);">‚òÅÔ∏è Push to Cloud</button>
        <a href="../index.html" class="btn btn-back">Back</a>
      </div>
      
      <div id="export-modal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;">
        <div style="background:white; padding:24px; border-radius:12px; max-width:800px; max-height:80vh; overflow:auto; margin:20px;">
          <h2>Export Data for Migration</h2>
          <p><strong>Step 1:</strong> Click "Copy to Clipboard" below</p>
          <p><strong>Step 2:</strong> Open <a href="http://localhost:8080/tournaments/import_data.html" target="_blank">http://localhost:8080/tournaments/import_data.html</a></p>
          <p><strong>Step 3:</strong> Paste in the big text box and click "Import Data"</p>
          <textarea id="export-textarea" readonly style="width:100%; height:300px; font-family:monospace; font-size:11px; padding:10px; border:1px solid #ccc; border-radius:4px; margin:10px 0;"></textarea>
          <div style="display:flex; gap:10px;">
            <button onclick="copyExportData()" style="background:#0b6efd; color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:600;">üìã Copy to Clipboard</button>
            <button onclick="closeExportModal()" style="background:white; border:1px solid #ccc; padding:10px 20px; border-radius:6px; cursor:pointer;">Close</button>
          </div>
        </div>
      </div>
    </main>

    <script>

      // Local tournament functions with Firebase sync
      function getTournaments() {
        try {
          const raw = localStorage.getItem('tournaments');
          return raw ? JSON.parse(raw) : [];
        } catch (err) {
          console.error('Failed to parse tournaments from localStorage', err);
          return [];
        }
      }

      function saveTournaments(tournaments) {
        localStorage.setItem('tournaments', JSON.stringify(tournaments || []));
        // Sync to Firebase
        if (typeof syncToFirebase !== 'undefined') {
          syncToFirebase('tournaments', tournaments || []).then(() => {
            console.log('‚úì Tournaments synced to Firebase');
          }).catch(e => console.log('Firebase sync failed:', e));
        }
      }

      let selectedTournamentIndex = null;
      let selectedTournamentOrigIndex = null;
      // sort state: key includes 'rounds'
      let sortState = { key: 'date', dir: 'desc' };

      function loadTournaments() {
        const tbody = document.getElementById('tournaments-body');
        tbody.innerHTML = '';

        const tournaments = getTournaments();

        // attach original index so we can map back to storage after sorting
        const augmented = tournaments.map((t, idx) => Object.assign({ _origIndex: idx }, t));

        // sort according to sortState
        augmented.sort((a, b) => {
          const key = sortState.key;
          let va = a[key];
          let vb = b[key];

          if (key === 'date') {
            va = va ? new Date(va) : new Date(0);
            vb = vb ? new Date(vb) : new Date(0);
            return sortState.dir === 'asc' ? va - vb : vb - va;
          }

          if (key === 'rounds') {
            va = (a.meta && a.meta.rounds) ? parseInt(a.meta.rounds,10) : (a.meta && Array.isArray(a.meta.roundsData) ? a.meta.roundsData.length : 1);
            vb = (b.meta && b.meta.rounds) ? parseInt(b.meta.rounds,10) : (b.meta && Array.isArray(b.meta.roundsData) ? b.meta.roundsData.length : 1);
            return sortState.dir === 'asc' ? va - vb : vb - va;
          }
          if (key === 'courses') {
            va = buildCoursesDisplay(a).toLowerCase();
            vb = buildCoursesDisplay(b).toLowerCase();
            if (va < vb) return sortState.dir === 'asc' ? -1 : 1;
            if (va > vb) return sortState.dir === 'asc' ? 1 : -1;
            return 0;
          }

          // string compare for other keys
          va = (va || '').toString().toLowerCase();
          vb = (vb || '').toString().toLowerCase();
          if (va < vb) return sortState.dir === 'asc' ? -1 : 1;
          if (va > vb) return sortState.dir === 'asc' ? 1 : -1;
          return 0;
        });

        if (tournaments.length === 0) {
          const row = tbody.insertRow();
          row.innerHTML = '<td colspan="6" style="text-align: center; color: #6b7280;">No tournaments yet. Click "New Tournament" to create one.</td>';
          return;
        }

        augmented.forEach((t, index) => {
          const row = tbody.insertRow();
          const tournamentId = t.tournamentId || '-';
          const roundsCount = (t.meta && t.meta.rounds) ? parseInt(t.meta.rounds,10) : (t.meta && Array.isArray(t.meta.roundsData) ? t.meta.roundsData.length : 1);
          const displayDate = formatTournamentDate(t);
          const coursesDisplay = buildCoursesDisplay(t);
          row.innerHTML = `<td>${escapeHtml(tournamentId)}</td><td>${displayDate}</td><td>${escapeHtml(t.name)}</td><td>${roundsCount}</td><td>${escapeHtml(coursesDisplay)}</td><td>${escapeHtml(t.type)}</td>`;
          row.dataset.index = index;
          row.dataset.origIndex = t._origIndex;
          row.addEventListener('click', () => selectTournament(index, row));
        });
      }

      const MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      function padDay(n){ return String(n).padStart(2,'0'); }
      function formatSingleDate(dateStr){
        if (!dateStr) return '-';
        const dt = new Date(dateStr);
        if (Number.isNaN(dt.getTime())) return '-';
        return `${padDay(dt.getDate())} ${MONTHS[dt.getMonth()]}. ${dt.getFullYear()}`;
      }
      function formatTournamentDate(t){
        if (!t.meta) return '-';
        const roundsData = Array.isArray(t.meta.roundsData) ? t.meta.roundsData.filter(r => r && r.date) : [];
        if (roundsData.length === 0) return formatSingleDate(t.date);
        if (roundsData.length === 1) return formatSingleDate(roundsData[0].date);
        const dates = roundsData.map(r => new Date(r.date)).filter(d => !Number.isNaN(d.getTime())).sort((a,b)=>a-b);
        if (!dates.length) return formatSingleDate(t.date);
        const first = dates[0];
        const last = dates[dates.length-1];
        const sameMonth = first.getMonth() === last.getMonth() && first.getFullYear() === last.getFullYear();
        if (sameMonth){
          return `${padDay(first.getDate())}-${padDay(last.getDate())} ${MONTHS[first.getMonth()]}. ${last.getFullYear()}`;
        }
        const yearDisplay = first.getFullYear() === last.getFullYear() ? last.getFullYear() : `${first.getFullYear()}/${last.getFullYear()}`;
        return `${padDay(first.getDate())} ${MONTHS[first.getMonth()]}. - ${padDay(last.getDate())} ${MONTHS[last.getMonth()]}. ${yearDisplay}`;
      }
      function buildCoursesDisplay(t){
        const coursesRaw = (t.meta && Array.isArray(t.meta.roundsData)) ? t.meta.roundsData.map(r => r.course).filter(Boolean) : (t.meta && Array.isArray(t.meta.courses) ? t.meta.courses : []);
        if (!coursesRaw.length) return '-';
        const seen = new Set();
        const orderedUnique = [];
        coursesRaw.forEach(c => { const key = c.toLowerCase(); if (!seen.has(key)){ seen.add(key); orderedUnique.push(c); }});
        let storedCourses = [];
        try { const raw = localStorage.getItem('courses'); storedCourses = raw ? JSON.parse(raw) : []; } catch(e) {}
        const mapped = orderedUnique.map(id => {
          const courseObj = storedCourses.find(c => c.courseId === id || c.fullName === id || c.name === id) || {};
          return courseObj.shortName || courseObj.fullName || courseObj.name || id;
        });
        return mapped.join(' / ');
      }

      // Simple escape to avoid injecting raw HTML from stored names/types
      function escapeHtml(str) {
        if (!str) return '';
        return String(str).replace(/[&"'<>]/g, function (s) {
          return ({ '&': '&amp;', '"': '&quot;', "'": '&#39;', '<': '&lt;', '>': '&gt;' })[s];
        });
      }

      // Add click handlers to headers to allow sorting
      function setupSorting() {
        const ths = document.querySelectorAll('#tournaments-table thead th');
        ths.forEach(th => {
          const key = th.dataset.key;
          if (!key) return;
          th.classList.add('sortable');
          th.addEventListener('click', () => {
            if (sortState.key === key) {
              // toggle direction
              sortState.dir = sortState.dir === 'asc' ? 'desc' : 'asc';
            } else {
              sortState.key = key;
              sortState.dir = 'asc';
            }
            // re-render
            loadTournaments();
            renderSortIndicators();
          });
        });
      }

      function renderSortIndicators() {
        const ths = document.querySelectorAll('#tournaments-table thead th');
        ths.forEach(th => {
          const key = th.dataset.key;
          let ind = th.querySelector('.sort-indicator');
          if (!ind) {
            ind = document.createElement('span');
            ind.className = 'sort-indicator';
            th.appendChild(ind);
          }
          if (key === sortState.key) {
            ind.textContent = sortState.dir === 'asc' ? '‚ñ≤' : '‚ñº';
          } else {
            ind.textContent = '';
          }
        });
      }

      function selectTournament(index, row) {
        // Remove previous selection
        document.querySelectorAll('#tournaments-body tr').forEach(r => r.classList.remove('selected'));
        // Add selection to clicked row
        row.classList.add('selected');
        selectedTournamentIndex = index;
        // also store the original storage index for reliable lookup
        selectedTournamentOrigIndex = parseInt(row.dataset.origIndex, 10);
        
        // Save selected tournament ID to localStorage
        const list = getTournaments();
        const selected = list[selectedTournamentOrigIndex];
        if (selected) {
          localStorage.setItem('lastSelectedTournamentId', selected.tournamentId);
        }
      }

      function restoreLastSelection() {
        const lastTournamentId = localStorage.getItem('lastSelectedTournamentId');
        if (!lastTournamentId) return;
        
        const rows = document.querySelectorAll('#tournaments-body tr');
        rows.forEach((row, index) => {
          const tournamentId = row.querySelector('td:first-child')?.textContent;
          if (tournamentId === lastTournamentId) {
            selectTournament(index, row);
            row.scrollIntoView({ block: 'center', behavior: 'smooth' });
          }
        });
      }

      // Initialize: Load from Firebase if available
      async function initializeTournaments() {
        // Wait for Firebase to be ready
        let attempts = 0;
        while (!syncEnabled && attempts < 10) {
          await new Promise(resolve => setTimeout(resolve, 200));
          attempts++;
        }
        
        console.log('Initializing tournaments, syncEnabled:', syncEnabled);
        
        // Try to load from Firebase
        if (syncEnabled && typeof loadTournamentsFromFirebase !== 'undefined') {
          try {
            const firebaseTournaments = await loadTournamentsFromFirebase();
            if (firebaseTournaments && firebaseTournaments.length > 0) {
              console.log('‚úì Loaded', firebaseTournaments.length, 'tournaments from Firebase');
            } else {
              console.log('No tournaments found in Firebase, using localStorage');
            }
          } catch(e) {
            console.log('Firebase load failed, using localStorage:', e);
          }
        }
        
        loadTournaments();
        setupSorting();
        renderSortIndicators();
        restoreLastSelection();
      }

      // Wait a moment for Firebase to initialize, then load
      setTimeout(initializeTournaments, 500);

      // Button event listeners
      document.getElementById('btn-new-tournament').addEventListener('click', () => {
        // Navigate to type selection page
        window.location.href = 'new.html';
      });

      document.getElementById('btn-modify-tournament').addEventListener('click', () => {
        if (selectedTournamentOrigIndex === null) {
          alert('Please select a tournament from the table above.');
          return;
        }
        const list = getTournaments();
        const selected = list[selectedTournamentOrigIndex];
        if (!selected) { alert('Selected tournament not found.'); return; }
        const page = selected.type && selected.type.toLowerCase().includes('stroke') ? 'stroke.html' : 'match.html';
        window.location.href = `${page}?edit=${selectedTournamentOrigIndex}`;
      });

      let selectedTournamentForModal = null;

      function closeRoundModal() {
        document.getElementById('round-modal').classList.remove('active');
        selectedTournamentForModal = null;
      }

      function confirmRoundSelection() {
        const roundId = document.getElementById('modal-round-select').value;
        if (selectedTournamentForModal && roundId) {
          window.location.href = `admissions.html?roundId=${encodeURIComponent(roundId)}`;
        }
      }

      document.getElementById('btn-admissions').addEventListener('click', () => {
        if (selectedTournamentOrigIndex === null) {
          alert('Please select a tournament from the table above.');
          return;
        }
        const list = getTournaments();
        const selected = list[selectedTournamentOrigIndex];
        if (!selected) {
          alert('Selected tournament not found.');
          return;
        }

        // Check if multi-round tournament
        const numRounds = selected.meta?.rounds || 1;
        const roundsData = selected.meta?.roundsData || [];
        const roundIds = selected.meta?.roundIds || [];
        
        if (numRounds > 1 && roundsData.length > 1) {
          // Show modal for round selection
          selectedTournamentForModal = selected;
          const modalSelect = document.getElementById('modal-round-select');
          modalSelect.innerHTML = '';
          
          // Determine default round based on current date
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          let defaultRoundIndex = 0;
          
          for (let i = 0; i < roundsData.length; i++) {
            if (roundsData[i].date) {
              const roundDate = new Date(roundsData[i].date);
              roundDate.setHours(0, 0, 0, 0);
              
              if (today >= roundDate) {
                defaultRoundIndex = i;
              } else {
                break;
              }
            }
          }
          
          roundsData.forEach((round, idx) => {
            const option = document.createElement('option');
            option.value = roundIds[idx] || `${selected.tournamentId}_R${idx + 1}`;
            option.textContent = `Round ${idx + 1}${round.date ? ' - ' + round.date : ''}`;
            if (idx === defaultRoundIndex) {
              option.selected = true;
            }
            modalSelect.appendChild(option);
          });
          document.getElementById('round-modal').classList.add('active');
        } else {
          // Single round, go directly
          const roundId = roundIds[0] || `${selected.tournamentId}_R1`;
          window.location.href = `admissions.html?roundId=${encodeURIComponent(roundId)}`;
        }
      });

      document.getElementById('btn-draw').addEventListener('click', () => {
        if (selectedTournamentOrigIndex === null) { alert('Please select a tournament from the table above.'); return; }
        const list = getTournaments(); const selected = list[selectedTournamentOrigIndex]; if (!selected) { alert('Selected tournament not found.'); return; }
        window.location.href = `draw.html?tournamentId=${selected.tournamentId}`;
      });

      document.getElementById('btn-categories').addEventListener('click', () => {
        if (selectedTournamentOrigIndex === null) { alert('Please select a tournament from the table above.'); return; }
        const list = getTournaments(); const selected = list[selectedTournamentOrigIndex]; if (!selected) { alert('Selected tournament not found.'); return; }
        window.location.href = `categories.html?tournamentId=${encodeURIComponent(selected.tournamentId)}`;
      });

      document.getElementById('btn-scores').addEventListener('click', () => {
        if (selectedTournamentOrigIndex === null) { alert('Please select a tournament from the table above.'); return; }
        const list = getTournaments(); const selected = list[selectedTournamentOrigIndex]; if (!selected) { alert('Selected tournament not found.'); return; }
        window.location.href = `scores_mode.html?tournamentId=${encodeURIComponent(selected.tournamentId)}`;
      });

      document.getElementById('btn-results').addEventListener('click', () => {
        if (selectedTournamentOrigIndex === null) { alert('Please select a tournament from the table above.'); return; }
        const list = getTournaments(); const selected = list[selectedTournamentOrigIndex]; if (!selected) { alert('Selected tournament not found.'); return; }
        window.location.href = `results.html?tournamentId=${encodeURIComponent(selected.tournamentId)}`;
      });

      document.getElementById('btn-documents').addEventListener('click', () => {
        if (selectedTournamentOrigIndex === null) {
          alert('Please select a tournament from the table above.');
          return;
        }
        const list = getTournaments();
        const selected = list[selectedTournamentOrigIndex];
        if (!selected) {
          alert('Selected tournament not found.');
          return;
        }
        window.location.href = `documents.html?tournamentId=${encodeURIComponent(selected.tournamentId)}`;
      });

      document.getElementById('btn-export-data').addEventListener('click', () => {
        const data = {
          tournaments: localStorage.getItem('tournaments'),
          players: localStorage.getItem('players'),
          courses: localStorage.getItem('courses'),
          admittedPlayers: localStorage.getItem('admittedPlayers'),
          scores: localStorage.getItem('scores'),
          categories: localStorage.getItem('categories'),
          draws: localStorage.getItem('draws')
        };
        
        document.getElementById('export-textarea').value = JSON.stringify(data);
        document.getElementById('export-modal').style.display = 'flex';
      });

      document.getElementById('btn-push-cloud').addEventListener('click', async () => {
        if (typeof syncToFirebase === 'undefined') {
          alert('Firebase not available. Please refresh the page.');
          return;
        }
        
        const tournaments = getTournaments();
        if (tournaments.length === 0) {
          alert('No tournaments to push.');
          return;
        }
        
        try {
          await syncToFirebase('tournaments', tournaments);
          alert('‚úÖ ' + tournaments.length + ' tournament(s) pushed to cloud successfully!');
        } catch (e) {
          alert('‚ùå Failed to push to cloud: ' + e.message);
        }
      });

      function copyExportData() {
        const textarea = document.getElementById('export-textarea');
        textarea.select();
        document.execCommand('copy');
        alert('‚úÖ Data copied to clipboard!\n\nNow open:\nhttp://localhost:8080/tournaments/import_data.html\n\nAnd paste it in the text box.');
      }

      function closeExportModal() {
        document.getElementById('export-modal').style.display = 'none';
      }

      document.getElementById('btn-delete-tournament').addEventListener('click', () => {
        if (selectedTournamentOrigIndex === null) {
          alert('Please select a tournament from the table above.');
          return;
        }

        const tournaments = getTournaments();
        const selected = tournaments[selectedTournamentOrigIndex];
        
        if (!selected) {
          alert('Selected tournament not found.');
          return;
        }

        // Check if tournament has admitted players
        const admittedPlayersData = JSON.parse(localStorage.getItem('admittedPlayers') || '{}');
        let hasAdmittedPlayers = false;
        
        if (selected.meta && selected.meta.roundIds) {
          selected.meta.roundIds.forEach(roundId => {
            if (admittedPlayersData[roundId] && admittedPlayersData[roundId].length > 0) {
              hasAdmittedPlayers = true;
            }
          });
        }

        if (hasAdmittedPlayers) {
          alert('Cannot delete tournament!\n\nThis tournament has admitted players.\n\nPlease remove all players from the tournament before deleting.');
          return;
        }

        // Check if tournament has scores
        const scoresData = JSON.parse(localStorage.getItem('scores') || '{}');
        let hasScores = false;
        
        if (selected.meta && selected.meta.roundIds) {
          selected.meta.roundIds.forEach(roundId => {
            if (scoresData[roundId] && Object.keys(scoresData[roundId]).length > 0) {
              hasScores = true;
            }
          });
        }

        if (hasScores) {
          alert('Cannot delete tournament!\n\nThis tournament has scores entered for players.\n\nPlease clear all scores before deleting.');
          return;
        }

        // Confirm deletion
        const confirmMessage = `Are you sure you want to delete this tournament?\n\nTournament: ${selected.name}\nID: ${selected.tournamentId}\n\nThis action cannot be undone.`;
        
        if (!confirm(confirmMessage)) {
          return;
        }

        // Delete tournament
        tournaments.splice(selectedTournamentOrigIndex, 1);
        localStorage.setItem('tournaments', JSON.stringify(tournaments));
        
        alert(`‚úÖ Tournament "${selected.name}" has been deleted successfully.`);
        location.reload();
      });
    </script>
  </body>
</html>
